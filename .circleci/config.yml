version: 2.1
jobs:
  build-server:
    docker:
      - image: rustlang/rust:nightly
    steps:
      - checkout
      - run:
          name: Rustup
          command: rustup toolchain install nightly; rustup default nightly
      - run:
          name: Version information
          command: rustc --version; cargo --version; rustup --version
      - run:
          name: Build
          command: cd server; cargo build --release

  build-client:
    docker:
      - image: node:lts
    steps:
      - checkout
      - run:
          name: Version information
          command: node --version; yarn --version
      - run:
          name: Install dependencies
          command: cd client; yarn
      - run:
          name: Build
          command: cd client; yarn build

workflows:
  build-deploy:
    jobs:
      - build-server
      - build-client
        # - deploy-server:
        # requires:
        # - build-server
        # filters:
        # branches:
        # only: master
